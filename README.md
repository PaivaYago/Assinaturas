# Assinaturas

<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/bea90da226e09b503e6c8fde824f4816b98dcf30cd31e803006bf6335af06890/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6a6176612d2532334544384230302e7376673f7374796c653d666f722d7468652d6261646765266c6f676f3d6f70656e6a646b266c6f676f436f6c6f723d7768697465"><img src="https://camo.githubusercontent.com/bea90da226e09b503e6c8fde824f4816b98dcf30cd31e803006bf6335af06890/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6a6176612d2532334544384230302e7376673f7374796c653d666f722d7468652d6261646765266c6f676f3d6f70656e6a646b266c6f676f436f6c6f723d7768697465" alt="Java" data-canonical-src="https://img.shields.io/badge/java-%23ED8B00.svg?style=for-the-badge&amp;logo=openjdk&amp;logoColor=white" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/9ee242f2c2b1eb587f7e42704b3a0629082aac88f66fff96d34723f777b07775/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f737072696e672d2532333644423333462e7376673f7374796c653d666f722d7468652d6261646765266c6f676f3d737072696e67266c6f676f436f6c6f723d7768697465"><img src="https://camo.githubusercontent.com/9ee242f2c2b1eb587f7e42704b3a0629082aac88f66fff96d34723f777b07775/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f737072696e672d2532333644423333462e7376673f7374796c653d666f722d7468652d6261646765266c6f676f3d737072696e67266c6f676f436f6c6f723d7768697465" alt="Spring" data-canonical-src="https://img.shields.io/badge/spring-%236DB33F.svg?style=for-the-badge&amp;logo=spring&amp;logoColor=white" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/544022edf8369d944e68802fc043b0268484709e334d23db2882590aeae296cb/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f706f7374677265732d2532333331363139322e7376673f7374796c653d666f722d7468652d6261646765266c6f676f3d706f737467726573716c266c6f676f436f6c6f723d7768697465"><img src="https://camo.githubusercontent.com/544022edf8369d944e68802fc043b0268484709e334d23db2882590aeae296cb/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f706f7374677265732d2532333331363139322e7376673f7374796c653d666f722d7468652d6261646765266c6f676f3d706f737467726573716c266c6f676f436f6c6f723d7768697465" alt="Postgres" data-canonical-src="https://img.shields.io/badge/postgres-%23316192.svg?style=for-the-badge&amp;logo=postgresql&amp;logoColor=white" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/6eff46a364eba690cb91a9f40084d97f96bf95699f3cb7722125dc1dc324fde1/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4a57542d626c61636b3f7374796c653d666f722d7468652d6261646765266c6f676f3d4a534f4e253230776562253230746f6b656e73"><img src="https://camo.githubusercontent.com/6eff46a364eba690cb91a9f40084d97f96bf95699f3cb7722125dc1dc324fde1/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4a57542d626c61636b3f7374796c653d666f722d7468652d6261646765266c6f676f3d4a534f4e253230776562253230746f6b656e73" alt="JWT" data-canonical-src="https://img.shields.io/badge/JWT-black?style=for-the-badge&amp;logo=JSON%20web%20tokens" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/cd7c747a20108fb05e6394c8740e99c6a472222f35d5a41ade053b03eceb871f/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f72656469732d2532334444303033312e7376673f7374796c653d666f722d7468652d6261646765266c6f676f3d7265646973266c6f676f436f6c6f723d7768697465"><img src="https://camo.githubusercontent.com/cd7c747a20108fb05e6394c8740e99c6a472222f35d5a41ade053b03eceb871f/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f72656469732d2532334444303033312e7376673f7374796c653d666f722d7468652d6261646765266c6f676f3d7265646973266c6f676f436f6c6f723d7768697465" alt="JWT" data-canonical-src="https://img.shields.io/badge/redis-%23DD0031.svg?style=for-the-badge&logo=redis&logoColor=white;logo=JSON%20web%20tokens" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/6863631ccfa46c1dcc000e5b14997d9d6590cc8655d14897783b6e94803cde96/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7261626269746d712d4646363630303f7374796c653d666f722d7468652d6261646765266c6f676f3d7261626269746d71266c6f676f436f6c6f723d7768697465"><img src="https://camo.githubusercontent.com/6863631ccfa46c1dcc000e5b14997d9d6590cc8655d14897783b6e94803cde96/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7261626269746d712d4646363630303f7374796c653d666f722d7468652d6261646765266c6f676f3d7261626269746d71266c6f676f436f6c6f723d7768697465" alt="JWT" data-canonical-src="https://img.shields.io/badge/Rabbitmq-FF6600?style=for-the-badge&logo=rabbitmq&logoColor=white;logo=JSON%20web%20tokens" style="max-width: 100%;"></a>
</p>


<p dir="auto">Este é um projeto construído utilizando <strong>Java com Spring, PostgresSQL como banco de dados, Spring Security e JWT para autenticação</strong>strong>. Além disso possui um banco em memória <strong>Redis</strong> para otimizar as consultas de dados e comunicação assíncrona utilizando <strong>RabbitMQ</strong>. O projeto está conteinerizado usando <strong>Docker</strong>. Os testes unitários são feitos com <strong>JUnit e Mockito</strong>. O software está documentado através do <strong>Swagger</strong>.</p>

<p dir="auto">O objetivo da API é realizar um controle de Usuários que se cadastram e Assinam planos de um streaming.</p>

## Requisitos
• Criar uma API para cadastrar usuários e criar uma assinatura.

• Um usuário pode ter apenas uma assinatura ativa por vez.

• A assinatura contém:
{
"id":"uuid",
"usuarioId":"uuid",
"plano":"PREMIUM",
"dataInicio":"2025-03-10",
"dataExpiracao":"2025-04-10",
"status":"ATIVA"
}
• O plano pode ser:
o BASICO - R$ 19,90/mês
o PREMIUM - R$ 39,90/mês
o FAMILIA - R$ 59,90/mês

• Implementar um agendador que renove assinaturas automaticamente no
dia do vencimento.

• Caso a renovação falhe (exemplo: erro de pagamento), a assinatura deve
ser suspensa após três tentativas.

• Criar um endpoint para cancelar a assinatura de um usuário.

• Se cancelada antes da expiração, o usuário pode continuar usando o
serviço até o fim do ciclo.

## Instalação
1- clonar o repository:
https://github.com/PaivaYago/Assinaturas.git

2- Intalar as dependêcia com o Maven;

3- Instalar o Oracle;

4- Instalar o RabbitMQ;

5- Instalar o Redis;

## Usabilidade
1- Startar a aplicação com Maven;

2- A API está disponível em http://localhost:8080;

3- A documentação está em http://localhost:8080/swagger-ui/index.html;

4- O RabbitMQ está em http://localhost:15672

5- Primeiro deve cadastrar um novo usuário e depois com as informações dele, gerar o Token JWT para que consiga se autenticar via Baerer Token nos outros endpoints.

## API Endpoints
POST/usuarios

GET/usuarios{id}

POST/login

GET/assinaturas/{usuarioID}

POST/assinaturas/{usuarioID}

DELETE/assinaturas/{usuarioID}

## Banco de Dados

CREATE TABLE usuarios (
	id uuid NOT NULL,
	email varchar(255) NOT NULL,
	nome varchar(255) NOT NULL,
	senha varchar NOT NULL,
	CONSTRAINT usuarios_pkey PRIMARY KEY (id)
);

create table assinaturas(
id uuid,
usuario_id uuid,
plano VARCHAR,
dataInicio DATE,
dataExpiracao DATE,
status VARCHAR,
tentativasPagamento INT,
primary key (id)
)

alter table assinaturas 
    add constraint fk_assinaturas_usuarios
    foreign key (usuario_id) 
    REFERENCES usuarios (id);



